---
title: "Draft"
author: "RQ3 district & rla_achievement, Tingyu Zou"
date: "2/16/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tmap)
library(edld652)
library(tidyverse)
library(skimr)
library(gghighlight)
list_datasets()
library(arrow)
library(here)
library(rio)
library(tigris)
library(leaflet)
```

```{r}
s <- get_data("EDFacts_rla_achievement_lea_2010_2019")
get_documentation("EDFacts_rla_achievement_lea_2010_2019")
ach <- filter(s,STNAM=="OREGON")


#LEAID--district number
#ALL_RLA00NUMVALID--The number of all students who completed a state assessment in Reading/Language Arts and for whom a proficiency level was assigned across all grades
#LEP_RLA00NUMVALID--Number of limited English proficient students that completed an assessment and for whom a proficiency level was assigned

ggplot(ach,aes(fct_reorder(LEAID,ALL_RLA00NUMVALID),ALL_RLA00NUMVALID,fill=LEP_RLA00NUMVALID))+
  geom_col()+
  coord_flip()+
  theme_classic()
   
          
ggplot(ach,aes(fct_reorder(LEAID,ALL_RLA00NUMVALID),ALL_RLA00NUMVALID))+
  geom_col(fill="#00ff7b")+
  coord_flip()+
  theme_classic() 


ggplot(ach,aes(fct_reorder(LEAID,LEP_RLA00NUMVALID),LEP_RLA00NUMVALID))+
  geom_col(fill="#00ffe1")+
  coord_flip()+
  theme_classic()   
  

ggplot(ach,aes(LEAID,LEP_RLA00NUMVALID))+
  geom_col(fill="#00ffe1")+
  theme_classic() 

```



```{r data_setup}
list_datasets()
district_math_participation <- as_tibble(get_data("EDFacts_math_achievement_lea_2010_2019"))
district_math_achievement <- as_tibble(get_data("EDFacts_math_participation_lea_2013_2019"))
district_reading_participation <- as_tibble(get_data("EDFacts_rla_participation_lea_2013_2019"))
district_reading_achievement <- as_tibble(get_data("EDFacts_rla_achievement_lea_2010_2019"))
district_ccd_fiscal_2012 <- as_tibble(get_data("NCES_CCD_fiscal_district_2012"))
district_directory <- as_tibble(get_data("NCES_CCD_nonfiscal_district_2017_2021_directory"))
district_el <- as_tibble(get_data("NCES_CCD_nonfiscal_district_2017_2021_english_learners"))
#district_membership <- as_tibble(get_data("NCES_CCD_nonfiscal_district_2017_2021_membership"))
head(district_el)
district_membership <- as_tibble(read_parquet(here( "district-membership-17-21.parquet")))
#school_membership <- as_tibble(read_parquet(here("school-membership-17-21.parquet")))

#head(district_reading_participation)

#take the above files, and filter to oregon data
or_district_math_achievement <- district_math_achievement %>% 
  filter(STNAM == "OREGON")
or_district_math_participation <- district_math_participation %>% 
  filter(STNAM == "OREGON")
or_district_rla_achievement <- district_reading_achievement %>% 
  filter(STNAM == "OREGON")
or_district_rla_participation <- district_reading_participation %>% 
  filter(STNAM == "OREGON")
or_district_fiscal_2012 <- district_ccd_fiscal_2012 %>% 
  filter(STNAME == "Oregon")
or_district_directory <- district_directory %>% 
  filter(STATENAME == "OREGON")
or_district_el <- district_el %>% 
  filter(STATENAME == "OREGON") %>% 
  select(LEAID,
         SCHOOL_YEAR,
         LEP_COUNT)

or_district_membership <- district_membership %>% 
  filter(STATENAME == "OREGON")

or_district_el_directory <- 
  left_join(or_district_directory,
            or_district_el,
            by="LEAID")

full_dataset <- left_join(or_district_el_directory,
                          or_district_rla_achievement,
                          by="LEAID") %>% 
  left_join(or_district_rla_participation,
            by="LEAID")

or_district_data <- school_districts(state=41)

pal <- colorNumeric(
  palette = "Blues",
  domain = full_dataset$LEP_COUNT)

leaflet(or_district_data) %>%
  addProviderTiles("CartoDB.Positron") %>% 
  addPolygons(color = ~pal(full_dataset$LEP_COUNT),
              weight = 0.5,
              fillOpacity = 1) 
```

```{r }
dli <- import(here("data","districts_dli.xlsx"))


#Merge membership and DLI data

```

## Creating a plot - need full dataset for this

```{r }

data %>%
  ggplot(aes(x=pct_white, y = pct_frpl, color = "dli_group" , size = "el_enrollment")) +
  geom_point() +
# create the quadrants
  geom_segment(aes(x = 100, y = 0, xend = 10, yend = 100)) +
  geom_segment(aes(x = 0, y = 0, xend = 0, yend = 100)) +
  geom_segment(aes(x = 0, y = 0, xend = 100, yend = 0)) +
  geom_segment(aes(x = 0, y = 5, xend = 100, yend = 50)) +
  geom_segment(aes(x = 50, y = 0, xend = 50, yend = 100)) +
  geom_segment(aes(x = 0, y = 100, xend = 100, yend = 100)) 
  


```
